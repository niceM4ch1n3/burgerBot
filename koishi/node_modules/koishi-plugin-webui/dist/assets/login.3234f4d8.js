import{defineComponent as E,ref as w,watch as V,resolveComponent as k,openBlock as i,createBlock as b,withCtx as c,createElementBlock as d,Fragment as f,createElementVNode as s,toDisplayString as _,createVNode as a,unref as o,normalizeClass as C,createCommentVNode as x,createTextVNode as p}from"../vue.js";import{useRouter as $}from"../vue-router.js";import{config as n,receive as A,user as T,send as B,sha256 as P}from"../client.js";const j=s("h1",null,[s("span",null,"\u5E73\u53F0\u8D26\u6237\u767B\u5F55")],-1),N={class:"hint"},U=s("p",{class:"hint"},"\u8BF7\u7528\u4E0A\u8FF0\u8D26\u53F7\u5C06\u4E0B\u9762\u7684\u9A8C\u8BC1\u7801\u79C1\u804A\u53D1\u9001\u7ED9\u4EFB\u610F\u673A\u5668\u4EBA",-1),I={class:"token"},S={class:"control"},z=p("\u8FD4\u56DE\u4E0A\u4E00\u6B65"),R={key:0},K=p(" / "),q={key:1},G=s("span",null,"\u5E73\u53F0\u8D26\u6237\u767B\u5F55",-1),H=[G],J={key:0,class:"error"},L={class:"control"},M=p("\u8FD4\u56DE"),O=p("\u83B7\u53D6\u9A8C\u8BC1\u7801"),Q={key:0,class:"error"},W={class:"control"},X=p("\u8FD4\u56DE"),Y=p("\u767B\u5F55");var Z=E({setup(ee){const v=isSecureContext;v||(n.value.authType=0);const l=w({}),h=$();A("login",u=>l.value=u),V(T,u=>{var e;!u||h.push(((e=h.currentRoute.value.redirectedFrom)==null?void 0:e.fullPath)||"/profile")});let g=0;async function y(){const u=Date.now();if(u<g)return;const{platform:e,userId:r}=n.value;!e||!r||(g=u+1e3,B("token",{platform:e,userId:r}))}async function F(){const{username:u,password:e}=n.value;B("login",{username:u,password:await P(e)})}return(u,e)=>{const r=k("k-button"),m=k("k-input"),D=k("k-card");return i(),b(D,{class:"login"},{default:c(()=>[l.value.token?(i(),d(f,{key:0},[j,s("p",N,"\u6B22\u8FCE\u4F60\uFF0C"+_(l.value.name||"Koishi \u7528\u6237")+"\uFF01",1),U,s("p",I,_(l.value.token),1),s("div",S,[a(r,{onClick:e[0]||(e[0]=t=>l.value.token=null)},{default:c(()=>[z]),_:1})])],64)):(i(),d(f,{key:1},[o(v)?(i(),d("h1",R,[s("span",{class:C({inactive:o(n).authType===1}),onClick:e[1]||(e[1]=t=>o(n).authType=0)},"\u5E73\u53F0\u8D26\u6237\u767B\u5F55",2),K,s("span",{class:C({inactive:o(n).authType===0}),onClick:e[2]||(e[2]=t=>o(n).authType=1)},"\u7528\u6237\u540D\u5BC6\u7801\u767B\u5F55",2)])):(i(),d("h1",q,H)),o(n).authType===0?(i(),d(f,{key:2},[a(m,{prefix:"at",placeholder:"\u5E73\u53F0\u540D",modelValue:o(n).platform,"onUpdate:modelValue":e[3]||(e[3]=t=>o(n).platform=t)},null,8,["modelValue"]),a(m,{prefix:"user",placeholder:"\u8D26\u53F7",modelValue:o(n).userId,"onUpdate:modelValue":e[4]||(e[4]=t=>o(n).userId=t),onEnter:y},null,8,["modelValue"]),l.value.message?(i(),d("p",J,_(l.value.message),1)):x("v-if",!0),s("div",L,[a(r,{onClick:e[5]||(e[5]=t=>u.$router.back())},{default:c(()=>[M]),_:1}),a(r,{onClick:y},{default:c(()=>[O]),_:1})])],64)):(i(),d(f,{key:3},[a(m,{prefix:"user",placeholder:"\u7528\u6237\u540D",modelValue:o(n).username,"onUpdate:modelValue":e[6]||(e[6]=t=>o(n).username=t)},null,8,["modelValue"]),a(m,{prefix:"lock",placeholder:"\u5BC6\u7801",modelValue:o(n).password,"onUpdate:modelValue":e[7]||(e[7]=t=>o(n).password=t),onEnter:F,type:o(n).showPass?"text":"password",suffix:o(n).showPass?"eye":"eye-slash",onClickSuffix:e[8]||(e[8]=t=>o(n).showPass=!o(n).showPass)},null,8,["modelValue","type","suffix"]),l.value.message?(i(),d("p",Q,_(l.value.message),1)):x("v-if",!0),s("div",W,[a(r,{onClick:e[9]||(e[9]=t=>u.$router.back())},{default:c(()=>[X]),_:1}),a(r,{onClick:F},{default:c(()=>[Y]),_:1})])],64))],64))]),_:1})}}}),ue=`section.login {
  max-width: 600px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  margin-bottom: 0 !important;
}
section.login .k-card-body {
  padding: 3rem 0 !important;
}
section.login h1 {
  font-size: 1.5rem;
  margin: 2.5rem auto;
  cursor: default;
}
section.login h1 span {
  transition: 0.3s ease;
}
section.login h1 span.inactive:hover {
  cursor: pointer;
  color: rgba(244, 244, 245, 0.8);
}
section.login h1 span:not(.inactive) {
  color: #f4f4f5;
}
section.login .token {
  font-weight: bold;
}
section.login .k-input {
  display: block;
  max-width: 400px;
  margin: 1rem auto;
}
section.login .control {
  margin: 2.5rem auto;
}
section.login .k-button {
  width: 8rem;
  margin: 0 1rem;
}`;export{Z as default};
